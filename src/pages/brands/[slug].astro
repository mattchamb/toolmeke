---
import Layout from '../../layouts/Layout.astro';
import ToolCard from '../../components/ToolCard.astro';
import brands from '../../data/brands.json';

export async function getStaticPaths() {
  return brands.map((brand) => ({
    params: { slug: brand.slug },
    props: { brand }
  }));
}

const { brand } = Astro.props;

// Load brand-specific tool data
let tools = [];
try {
  const brandData = await import(`../../data/brand_${brand.slug}.json`);
  tools = brandData.default || [];
} catch (error) {
  console.warn(`Could not load data for brand: ${brand.slug}`);
}

const title = `${brand.name} Tools - ToolMeke`;
const description = `Compare prices for ${brand.name} tools across New Zealand hardware stores`;
---

<Layout title={title} description={description}>
  <section class="section">
    <div class="container">
      <div class="mb-6">
        <h1 class="title is-1 has-text-dark">{brand.name} Tools</h1>
        <p class="subtitle is-4 has-text-grey mb-4">
          Compare prices for {brand.name} tools across New Zealand hardware stores
        </p>
        <div class="is-flex is-align-items-center mb-4">
          <span class="is-size-6 has-text-weight-semibold has-text-dark mr-2">Total Tools:</span>
          <span class="is-size-6 has-text-grey">{brand.toolCount}</span>
        </div>
      </div>

      {tools.length > 0 ? (
        <div class="columns is-multiline">
          {tools.slice(0, 50).map((tool) => (
            <div class="column is-12-mobile is-6-tablet is-4-desktop">
              <ToolCard tool={tool} />
            </div>
          ))}
        </div>
      ) : (
        <div class="has-text-centered py-6">
          <p class="subtitle is-4 has-text-grey">No tools data available for {brand.name} at the moment.</p>
          <p class="is-size-5 has-text-grey">Please check back later for updated pricing information.</p>
        </div>
      )}

      {tools.length > 50 && (
        <div class="has-text-centered mt-5">
          <p class="is-size-5 has-text-grey">
            Showing first 50 tools. Total available: {brand.toolCount}
          </p>
        </div>
      )}
    </div>
  </section>
</Layout>
